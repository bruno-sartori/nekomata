{"version":3,"file":"index.js","sourceRoot":"","sources":["../src/index.ts"],"names":[],"mappings":"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","sourcesContent":["import { LitElement, html } from 'lit';\nimport { customElement, state } from 'lit/decorators.js';\nimport './components/editor/editor-sidebar';\nimport './components/editor/editor-video';\nimport './components/editor/editor-toolbar';\nimport './components/editor/editor-timeline';\nimport { nekomataStyle } from './styles/nekomata.style';\nimport { ChapterRange, CurrentlyGrabbed, FillTimeline, Progress, RangeTimings, SeekableStyle } from './types';\nimport UpdateCurrentlyGrabbedEvent from './events/update-currently-grabbed';\nimport VideoPauseEvent from './events/video-pause';\nimport VideoSeekEvent from './events/video-seek';\nimport FilesAddedEvent from './events/files-added';\nimport VideoLoadedEvent from './events/video-loaded';\nimport FillTimelineEvent from './events/fill-timeline';\nimport AddGrabbersEvent from './events/add-grabbers';\nimport SeekableResizedEvent from './events/seekable-resized';\nimport UpdateSeekableStyleEvent from './events/update-seekable-style';\nimport UpdateProgressEvent from './events/update-progress';\nimport AppendSnapshotEvent from './events/append-snapshot';\nimport ChapterAddedEvent from './events/chapter-added';\nimport UpdateTimingsEvent from './events/update-timings';\nimport { provide } from '@lit/context';\nimport { playerContext } from './contexts/player-context';\nimport { PlayerContext } from './@types/contexts';\nimport UpdatePlayerContextEvent from './events/update-player-context';\n\n@customElement('nekomata-editor')\nexport class Nekomata extends LitElement {\n  static override styles = nekomataStyle;\n\n  @state()\n  timings: Array<RangeTimings>  = [];\n  \n  @state()\n  currentlyGrabbed: CurrentlyGrabbed = { index: 0, type: 'none' };\n\n  @state()\n  files?: FileList;\n\n  @state()\n  fillTimeline: FillTimeline = {\n    duration: 0,\n    metric: 'hours',\n    fill: false,\n  }\n\n  @state()\n  shouldShowGrabbers = false;\n\n  @state()\n  seekableRect?: DOMRect;\n\n  @state()\n  seekableStyle: SeekableStyle = {\n    backgroundImage: ''\n  };\n\n  @state()\n  progress: Progress = {};\n\n  @state()\n  snapshots: Array<HTMLCanvasElement> = [];\n\n  @state()\n  chapters: Array<ChapterRange> = [];\n\n  @provide({ context: playerContext })\n  playerCtx: PlayerContext = {\n    duration: 0,\n    playing: false,\n    seek: 0,\n    src: ''\n  };\n\n  constructor() {\n    super();\n    \n    this.addEventListener(UpdateCurrentlyGrabbedEvent.eventName, ((e: UpdateCurrentlyGrabbedEvent) => {\n      this.currentlyGrabbed = e.detail;\n    }) as EventListener);\n\n    this.addEventListener(VideoPauseEvent.eventName, () => {\n      this.playerCtx = {\n        ...this.playerCtx,\n        playing: false\n      };\n    });\n\n    this.addEventListener(VideoSeekEvent.eventName, ((e: VideoSeekEvent) => {\n      this.playerCtx = {\n        ...this.playerCtx,\n        seek: e.detail.seekTime\n      };\n    }) as EventListener);\n\n    this.addEventListener(FilesAddedEvent.eventName, ((e: FilesAddedEvent) => {\n      this.files = e.detail.files;\n      this.playerCtx = {\n        ...this.playerCtx,\n        src: URL.createObjectURL(e.detail.files[0]),\n        playing: true,\n      };\n    }) as EventListener);\n\n    this.addEventListener(VideoLoadedEvent.eventName, ((e: VideoLoadedEvent) => {\n      this.playerCtx = {\n        ...this.playerCtx,\n        duration: e.detail.duration\n      };\n    }) as EventListener);\n\n    this.addEventListener(FillTimelineEvent.eventName, ((e: FillTimelineEvent) => {\n      this.fillTimeline.duration = e.detail.duration;\n      this.fillTimeline.metric = e.detail.metric;\n      this.fillTimeline.fill = true;\n    }) as EventListener);\n\n    this.addEventListener(AddGrabbersEvent.eventName, (() => {\n      this.shouldShowGrabbers = true;\n    }) as EventListener);\n\n    this.addEventListener(SeekableResizedEvent.eventName, ((e: SeekableResizedEvent) => {\n      this.seekableRect = e.detail.rect\n    }) as EventListener);\n\n    this.addEventListener(UpdateSeekableStyleEvent.eventName, ((e: UpdateSeekableStyleEvent) => {\n      this.seekableStyle = e.detail.style;\n    }) as EventListener);\n\n    this.addEventListener(UpdateProgressEvent.eventName, ((e: UpdateProgressEvent) => {\n      if (e.detail.width) {\n        this.progress = {\n          ...this.progress,\n          width: e.detail.width\n        };\n      }\n      if (e.detail.left) {\n        this.progress = {\n          ...this.progress,\n          left: e.detail.left\n        };\n      }\n    }) as EventListener);\n\n    this.addEventListener(AppendSnapshotEvent.eventName, ((e: AppendSnapshotEvent) => {\n      this.snapshots = [...this.snapshots, e.detail.snapshot];\n    }) as EventListener);\n\n    this.addEventListener(ChapterAddedEvent.eventName, ((e: ChapterAddedEvent) => {\n      this.chapters = [...this.chapters, e.detail];\n    }) as EventListener);\n\n    this.addEventListener(UpdateTimingsEvent.eventName, ((e: UpdateTimingsEvent) => {\n      console.log('UpdateTimingsEvent', e.detail)\n      this.timings = e.detail.timings || [];\n    }) as EventListener);\n\n    this.addEventListener(UpdatePlayerContextEvent.eventName, ((e: UpdatePlayerContextEvent) => {\n      this.playerCtx = {\n        ...this.playerCtx,\n        ...e.detail\n      };\n    }) as EventListener);\n  }\n\n  override render() {\n    return html`\n      <main class=\"nekomata-editor\">\n        <aside class=\"sidebar\">\n          <editor-sidebar></editor-sidebar>\n        </aside>\n        <section class=\"editor\">\n          <editor-video .timings=${this.timings}></editor-video>\n        </section>\n        <section class=\"editor-toolbar\">\n          <editor-toolbar \n            .timings=${this.timings} \n            .files=${this.files}\n          ></editor-toolbar>\n          <editor-timeline\n            .shouldShowGrabbers=${this.shouldShowGrabbers}\n            .timings=${this.timings} \n            .currentlyGrabbed=${this.currentlyGrabbed}\n            .fillTimeline=${this.fillTimeline}\n            .seekableRect=${this.seekableRect}\n            .seekableStyle=${this.seekableStyle}\n            .progress=${this.progress}\n            .snapshots=${this.snapshots}\n            .chapters=${this.chapters}\n          ></editor-timeline>\n        </section>\n      </main>\n    `;\n  }\n}\n\ndeclare global {\n  interface HTMLElementTagNameMap {\n    'nekomata-editor': Nekomata;\n  }\n}\n"]}