{"version":3,"file":"editor-video.js","sourceRoot":"","sources":["../../../src/components/editor/editor-video.ts"],"names":[],"mappings":"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","sourcesContent":["import { LitElement, PropertyValues, html } from 'lit';\nimport { customElement, query, state } from 'lit/decorators.js';\nimport { videoSidebarStyle } from '../../styles/editor-video.style';\nimport UpdateTimingsEvent from '../../events/update-timings';\nimport { RangeTimings } from '../../types';\nimport UpdateTimeInfoEvent from '../../events/update-time-info';\nimport { secondsToHours, secondsToMinutes } from '../../utils/time';\nimport UpdateTimelineContextEvent from '../../events/update-timeline-context';\nimport AppendSnapshotEvent from '../../events/append-snapshot';\nimport { consume } from '@lit/context';\nimport { initialPlayerContext, playerContext } from '../../contexts/player-context';\nimport { PlayerContext } from '../../@types/contexts';\nimport UpdatePlayerContextEvent from '../../events/update-player-context';\nimport UpdateSeekableContextEvent from '../../events/update-seekable-context';\nimport UpdateGrabbersContextEvent from '../../events/update-grabbers-context';\n\n@customElement('editor-video')\nexport class EditorVideo extends LitElement {\n  static override styles = videoSidebarStyle;\n\n  @state()\n  private timings: Array<RangeTimings> = []; \n\n  @query('#video')\n  private video: HTMLVideoElement | undefined;\n\n  @consume({ context: playerContext, subscribe: true })\n  @state()\n  private playerCtx: PlayerContext = initialPlayerContext;\n\n  private shouldAddActiveSegments = false;\n\n  protected override firstUpdated(_changedProperties: PropertyValues): void {\n    this.dispatchEvent(new UpdatePlayerContextEvent({ video: this.video }));\n  }\n\n  override updated(changedProperties: Map<string, unknown>) {\n    console.log(changedProperties);\n    \n    if (changedProperties.has('playerCtx')) {\n      const oldPlayerContext = changedProperties.get('playerCtx') as PlayerContext;\n\n      if (this.playerCtx?.src !== oldPlayerContext?.src) {\n        this.video!.src = this.playerCtx?.src;\n        this.video?.play();\n      }\n\n      if (this.playerCtx?.playing !== oldPlayerContext?.playing) {\n        if (this.playerCtx.playing) {\n          this.video?.play();\n        } else {\n          this.video?.pause();\n        }\n      }\n\n      if (this.playerCtx?.seek !== oldPlayerContext?.seek) {\n        this.video!.currentTime = this.playerCtx.seek;\n      }\n      \n    }\n\n    if (changedProperties.has('timings') && this.shouldAddActiveSegments) {\n      this.addActiveSegments();\n    }\n\n    console.log(changedProperties)\n  }\n\n  override render() {\n    return html`\n      <div class=\"wrapper\">\n        <video \n          id=\"video\" \n          autoload=\"metadata\"\n          muted\n          class=\"video\" \n          @click=\"${this.handleTogglePlayer}\" \n          @timeupdate=\"${this.handleTimeUpdate}\" \n          @loadeddata=\"${this.handleMediaLoaded}\"\n          @loadedmetadata=\"${this.handleLoadedMetadata}\"\n        ></video>\n        <div style=\"z-index: 9999; color: #fff; font-size: 30px;\">${JSON.stringify(this.playerCtx)}</div>\n      </div>\n    `;\n  }\n\n  private fillVideoInfo() {\n    const currentTime = this.video!.currentTime;\n    const duration = this.video!.duration;\n    this.dispatchEvent(new UpdateTimeInfoEvent({ bubbles: true, composed: true, detail: { currentTime, duration }}))\n    \n    const durationHours = secondsToHours(this.video!.duration);\n    const durationMinutes = secondsToMinutes(this.video!.duration);\n  \n    const timelineDuration = durationHours > 1 ? durationHours : durationMinutes;\n    const timelineMetric = durationHours > 1 ? 'hours' : 'minutes';\n\n    this.dispatchEvent(new UpdateTimelineContextEvent({ \n      duration: timelineDuration, \n      metric: timelineMetric, \n      fill: true \n    }));\n  }\n\n  private handleTogglePlayer(teste: string) { // teste new git hook\n    console.log(teste)\n    if (this.video?.paused) {\n      this.video.play();\n    } else {\n      this.video?.pause();\n    }\n  }\n\n  private handleTimeUpdate() {\n    this.dispatchEvent(new UpdatePlayerContextEvent({ currentTime: this.video!.currentTime }));\n  }\n\n  private handleMediaLoaded() {\n    this.dispatchEvent(new UpdatePlayerContextEvent({ loaded: true, duration: this.video!.duration }));\n  }\n\n  private createSnapshotList() {\n    const capture = () => {\n      if (this.video) {\n        const height = 90;\n        const width = Math.round((16 / 9) * height);\n      \n        const canvas = document.createElement(\"canvas\");\n        canvas.width = width;\n        canvas.height = height;\n        canvas.getContext(\"2d\")?.drawImage(this.video, 0, 0, width, height);\n    \n        this.dispatchEvent(new AppendSnapshotEvent({ bubbles: true, composed: true, detail: { snapshot: canvas }}));\n      } else {\n        console.log('FAILED CAPTURE')\n      }\n    }\n\n    this.video?.addEventListener('seeked', capture);\n  \n    const updateTime = () => {\n      let i = 1;\n      const interval = setInterval(() => {\n        this.video!.currentTime = i * 15;\n        i++;\n  \n        if (i === 16) {\n          clearInterval(interval);\n        }\n      }, 70);\n    };\n  \n    updateTime();\n  }\n\n  private addActiveSegments() {\n    let colors = ''\n    let counter = 0;\n    \n    console.log('ADD ACTIVE SEGMENTS', this.timings);\n\n    if (this.timings.length > 0) {\n      colors += `, rgba(240, 240, 240, 0) 0%, rgba(240, 240, 240, 0) ${this.timings?.[0]?.start / this.video!.duration * 100}%`\n      for (let times of this.timings) {\n        if (counter > 0) {\n          colors += `, rgba(240, 240, 240, 0) ${this.timings[counter].end / this.video!.duration * 100}%, rgba(240, 240, 240, 0) ${times.start / this.video!.duration * 100}%`\n        }\n        colors += `, #655dc2 ${times.start / this.video!.duration * 100}%, #655dc2 ${times.end / this.video!.duration * 100}%`\n        counter += 1\n      }\n      colors += `, rgba(240, 240, 240, 0) ${this.timings?.[counter - 1]?.end / this.video!.duration * 100}%, rgba(240, 240, 240, 0) 100%`\n      \n      this.dispatchEvent(new UpdateSeekableContextEvent({ style: { backgroundImage: `linear-gradient(to right${colors})` }}));\n    }\n  }\n\n  private handleLoadedMetadata() {\n    console.log('handleLoadedMetadata', 'init');\n    console.log('handleLoadedMetadata - timings', this.timings);\n\n    this.shouldAddActiveSegments = true;\n\n    if (this.timings.length === 0) {\n      this.dispatchEvent(new UpdateTimingsEvent({ bubbles: true, composed: true, detail: { timings: [{ start: 0, end: 120 }] } }));\n      this.dispatchEvent(new UpdateGrabbersContextEvent({ visible: true }));\n    }\n\n    this.fillVideoInfo();\n    this.createSnapshotList();\n  }\n}\n\ndeclare global {\n  interface HTMLElementTagNameMap {\n    'editor-video': EditorVideo;\n  }\n}\n"]}