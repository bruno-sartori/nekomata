{"version":3,"file":"editor-video.js","sourceRoot":"","sources":["../../../src/components/editor/editor-video.ts"],"names":[],"mappings":"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","sourcesContent":["import { LitElement, html } from 'lit';\nimport { customElement, property, query, state } from 'lit/decorators.js';\nimport { videoSidebarStyle } from '../../styles/editor-video.style';\nimport VideoTimeUpdatedEvent from '../../events/video-time-update';\nimport VideoLoadedEvent from '../../events/video-loaded';\nimport VideoPauseEvent from '../../events/video-pause';\nimport UpdateTimingsEvent from '../../events/update-timings';\nimport { RangeTimings } from '../../types';\nimport AddGrabbersEvent from '../../events/add-grabbers';\nimport UpdateTimeInfoEvent from '../../events/update-time-info';\nimport { secondsToHours, secondsToMinutes } from '../../utils/time';\nimport FillTimelineEvent from '../../events/fill-timeline';\nimport AppendSnapshotEvent from '../../events/append-snapshot';\nimport UpdateSeekableStyleEvent from '../../events/update-seekable-style';\n\n@customElement('editor-video')\nexport class EditorVideo extends LitElement {\n  static override styles = videoSidebarStyle;\n\n  @property({ type: Array })\n  timings: Array<RangeTimings> = []; \n\n  @property({ type: Boolean })\n  videoPlaying = false; \n  \n  @state()\n  videoSeekTime = 0;\n\n  @state()\n  videoSrc = ''; \n\n  @query('#video')\n  video: HTMLVideoElement | undefined;\n\n  constructor() {\n    super();\n\n    console.log(this.videoSeekTime)\n\n    this.addEventListener(VideoPauseEvent.eventName, () => {\n      this.video?.pause();\n    });\n  }\n\n  override updated(changedProperties: Map<string, unknown>) {\n    console.log(`updated(). changedProps: `, changedProperties);\n    console.log(changedProperties.has(\"videoSrc\"))\n    if (changedProperties.has(\"videoSrc\")) {\n      this.video!.src = this.videoSrc;\n      this.video?.play();\n    }\n    if (changedProperties.has('videoPlaying')) {\n      if (this.videoPlaying) {\n        this.video?.play();\n      } else {\n        this.video?.pause();\n      }\n    }\n\n    if (changedProperties.has('videoSeekTime')) {\n      this.video!.currentTime = this.videoSeekTime;\n    }\n  }\n\n  override render() {\n    return html`\n      <div class=\"wrapper\">\n        <video \n          id=\"video\" \n          autoload=\"metadata\"\n          class=\"video\" \n          @click=\"${this.handleTogglePlayer}\" \n          @timeupdate=\"${this.handleTimeUpdate}\" \n          @loadeddata=\"${this.handleMediaLoaded}\"\n          @loadedmetadata=\"${this.handleLoadedMetadata}\"\n        ></video>\n      </div>\n    `;\n  }\n\n  private fillVideoInfo() {\n    const currentTime = this.video!.currentTime;\n    const duration = this.video!.duration;\n    this.dispatchEvent(new UpdateTimeInfoEvent({ bubbles: true, composed: true, detail: { currentTime, duration }}))\n    \n    const durationHours = secondsToHours(this.video!.duration);\n    const durationMinutes = secondsToMinutes(this.video!.duration);\n  \n    const timelineDuration = durationHours > 1 ? durationHours : durationMinutes;\n    const timelineMetric = durationHours > 1 ? 'hours' : 'minutes';\n\n    this.dispatchEvent(new FillTimelineEvent({ bubbles: true, composed: true, detail: { duration: timelineDuration, metric: timelineMetric }}));\n  }\n\n  private handleTogglePlayer() {\n    if (this.video?.paused) {\n      this.video.play();\n    } else {\n      this.video?.pause();\n    }\n  }\n\n  private handleTimeUpdate() {\n    const seek = this.video!.currentTime / this.video!.duration * 100;\n    this.dispatchEvent(new VideoTimeUpdatedEvent({ bubbles: true, composed: true, detail: { seek, currentTime: this.video!.currentTime, duration: this.video!.duration } }));\n  }\n\n  private handleMediaLoaded() {\n    this.dispatchEvent(new VideoLoadedEvent({ bubbles: true, composed: true, detail: { duration: this.video!.duration } }));\n  }\n\n  private capture() {\n    const height = 90;\n    const width = Math.round((16 / 9) * height);\n  \n    const canvas = document.createElement(\"canvas\");\n    canvas.width = width;\n    canvas.height = height;\n    canvas.getContext(\"2d\")?.drawImage(this.video!, 0, 0, width, height);\n\n    this.dispatchEvent(new AppendSnapshotEvent({ bubbles: true, composed: true, detail: { snapshot: canvas }}));\n  }\n\n  private createSnapshotList() {\n    this.video?.addEventListener('seeked', this.capture);\n  \n    const updateTime = () => {\n      let i = 1;\n      const interval = setInterval(() => {\n        this.video!.currentTime = i * 15;\n        i++;\n  \n        if (i === 16) {\n          clearInterval(interval);\n        }\n      }, 500);\n    };\n  \n    updateTime();\n  }\n\n  private addActiveSegments() {\n    let colors = ''\n    let counter = 0;\n    \n    colors += `, rgba(240, 240, 240, 0) 0%, rgba(240, 240, 240, 0) ${this.timings[0].start / this.video!.duration * 100}%`\n    for (let times of this.timings) {\n      if (counter > 0) {\n        colors += `, rgba(240, 240, 240, 0) ${this.timings[counter].end / this.video!.duration * 100}%, rgba(240, 240, 240, 0) ${times.start / this.video!.duration * 100}%`\n      }\n      colors += `, #655dc2 ${times.start / this.video!.duration * 100}%, #655dc2 ${times.end / this.video!.duration * 100}%`\n      counter += 1\n    }\n    colors += `, rgba(240, 240, 240, 0) ${this.timings[counter - 1].end / this.video!.duration * 100}%, rgba(240, 240, 240, 0) 100%`\n    \n    this.dispatchEvent(new UpdateSeekableStyleEvent({ bubbles: true, composed: true, detail: { style: { backgroundImage: `linear-gradient(to right${colors})` }}}));\n  }\n\n  private handleLoadedMetadata() {\n    if (this.timings.length === 0) {\n      this.dispatchEvent(new UpdateTimingsEvent({ bubbles: true, composed: true, detail: { timings: [{ start: 0, end: 120 }] } }));\n      this.dispatchEvent(new AddGrabbersEvent({ bubbles: true, composed: true }));\n    }\n\n    this.fillVideoInfo();\n    this.createSnapshotList();\n    this.addActiveSegments();\n  }\n}\n\ndeclare global {\n  interface HTMLElementTagNameMap {\n    'editor-video': EditorVideo;\n  }\n}\n"]}